#!/bin/bash
# Malicious Domain Detection Examples
# Uses Quad9's threat intelligence to identify known malicious domains

echo "=== Example 1: Check Known Good Domains ==="
./bin/dnsgeeo --list "google.com,github.com,cloudflare.com" \
  --check-malicious \
  --pretty

echo -e "\n=== Example 2: Check Known Blocked Domain ==="
./bin/dnsgeeo --list "isitblocked.org" \
  --check-malicious \
  --pretty

echo -e "\n=== Example 3: Mixed Good and Bad Domains ==="
./bin/dnsgeeo --list "google.com,isitblocked.org,github.com" \
  --check-malicious \
  --output /tmp/malware-check.json \
  --pretty

echo "Results saved to /tmp/malware-check.json"

echo -e "\n=== Example 4: Filter Malicious Domains ==="
./bin/dnsgeeo --list "google.com,isitblocked.org,github.com,cloudflare.com" \
  --check-malicious | \
  python3 -c "
import json, sys
data = json.load(sys.stdin)
malicious = [d for d in data if d.get('malicious', False)]
if malicious:
    print('Malicious domains detected:')
    for domain in malicious:
        print(f'  - {domain[\"domain\"]}')
        for ip in domain.get('ips', []):
            print(f'    IP: {ip[\"ip\"]}')
else:
    print('No malicious domains detected')
"

echo -e "\n=== Example 5: Bulk Security Scan ==="
cat > /tmp/domains-to-check.txt << 'EOF'
google.com
github.com
isitblocked.org
microsoft.com
cloudflare.com
EOF

echo "Scanning domains for threats..."
./bin/dnsgeeo --list "$(cat /tmp/domains-to-check.txt | tr '\n' ',')" \
  --check-malicious \
  --parallel 10 | \
  python3 -c "
import json, sys
data = json.load(sys.stdin)
total = len(data)
resolved = sum(1 for d in data if d['resolved'])
malicious = sum(1 for d in data if d.get('malicious', False))

print(f'Scan Results:')
print(f'  Total domains: {total}')
print(f'  Resolved: {resolved}')
print(f'  Malicious: {malicious}')
print(f'  Clean: {resolved - malicious}')

if malicious > 0:
    print(f'\nMalicious domains:')
    for d in data:
        if d.get('malicious'):
            print(f'  ⚠️  {d[\"domain\"]}')
"

echo -e "\n=== Example 6: Generate Security Report ==="
./bin/dnsgeeo --list "google.com,isitblocked.org,github.com" \
  --check-malicious | \
  python3 -c "
import json, sys
from datetime import datetime

data = json.load(sys.stdin)

print('Security Scan Report')
print('=' * 50)
print(f'Timestamp: {datetime.now().isoformat()}')
print(f'Total Domains Scanned: {len(data)}')
print()

for domain in data:
    status = '✅ CLEAN' if not domain.get('malicious') else '⚠️ MALICIOUS'
    resolved = '✓' if domain['resolved'] else '✗'
    print(f'{domain[\"domain\"]:30} {status:15} Resolved: {resolved}')
    if domain.get('malicious'):
        print(f'  └─ Blocked by Quad9 threat intelligence')
"
